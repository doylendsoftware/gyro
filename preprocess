#!/usr/bin/python

import os
import sys
import re

to_replace = sys.argv[1]

def qg(path):
    f = open(path)
    data = f.read()
    f.close()
    return data
    
def replace(path):
    #print path
    data = qg(path)
    #print data    
    includes = [i[len('#include <'):-1] for i in re.findall('#include <.*>',data)]
    #print includes
    for item in includes:
        data = data.replace('#include <'+item+'>', replace(os.path.join(os.path.dirname(path),item)))
    
    return data
        
f = open('bin/kernel.spin','w')
f.write('\'THIS FILE IS AUTOMATICALLY GENERATED BY THE PREPROCESSOR.\n\'DO NOT OVERWRITE.\n\n')
f.write(replace(to_replace))
f.close()
